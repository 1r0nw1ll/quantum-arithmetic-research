{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "QA_IC_VERIFICATION_RECEIPT.v1",
  "title": "QA Instruction/Content Verification Receipt",
  "description": "Cryptographically-bound proof that content was scanned under a specific scanner/policy/patterns snapshot. Eliminates verified=true spoofing.",
  "type": "object",
  "required": [
    "schema_id",
    "scanner_id",
    "scanner_version",
    "patterns_sha256",
    "policy_sha256",
    "content_sha256",
    "decision",
    "threats_found",
    "issued_utc",
    "receipt_sha256",
    "signature"
  ],
  "properties": {
    "schema_id": {
      "const": "QA_IC_VERIFICATION_RECEIPT.v1"
    },
    "scanner_id": {
      "type": "string",
      "description": "Identifier for the scanner that issued this receipt"
    },
    "scanner_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Semver version of the scanner"
    },
    "patterns_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 of normalized pattern lists (sorted, newline-joined, category-tagged)"
    },
    "policy_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 of canonical JSON of scanning-relevant policy subset"
    },
    "content_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 of content bytes (UTF-8)"
    },
    "decision": {
      "enum": ["VERIFIED_SAFE", "VERIFIED_UNSAFE"],
      "description": "Scanner's determination"
    },
    "threats_found": {
      "type": "boolean"
    },
    "threat_patterns": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Patterns that matched (empty if safe)"
    },
    "issued_utc": {
      "type": "string",
      "format": "date-time"
    },
    "receipt_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 of domain-tagged receipt body: sha256('QA_IC_VERIFICATION_RECEIPT.v1\\n' + canonical_json)"
    },
    "signature": {
      "type": "object",
      "description": "Cryptographic signature. Use {\"alg\":\"none\"} for hash-only mode.",
      "required": ["alg"],
      "properties": {
        "alg": {
          "enum": ["ed25519", "none"],
          "description": "Algorithm: 'none' for hash-only, 'ed25519' for signed"
        },
        "pubkey": {
          "type": "string",
          "pattern": "^[a-f0-9]+$",
          "minLength": 64,
          "description": "Hex-encoded Ed25519 public key (32 bytes = 64 hex chars)"
        },
        "sig": {
          "type": "string",
          "pattern": "^[a-f0-9]+$",
          "minLength": 128,
          "description": "Hex-encoded Ed25519 signature (64 bytes = 128 hex chars)"
        }
      },
      "additionalProperties": false
    },
    "generator_set_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "Optional hash of active generator set for tool surface binding"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "signature": {
            "properties": { "alg": { "const": "ed25519" } },
            "required": ["alg"]
          }
        }
      },
      "then": {
        "properties": {
          "signature": {
            "required": ["alg", "pubkey", "sig"]
          }
        }
      },
      "else": {
        "properties": {
          "signature": {
            "properties": {
              "pubkey": false,
              "sig": false
            }
          }
        }
      }
    }
  ]
}
