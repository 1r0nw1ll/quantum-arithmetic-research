{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "QA_MAP_MODULE_SPINE.v1.schema.json",
  "title": "QA_MAP_MODULE_SPINE.v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version", "module_id", "title", "authors", "created_utc",
    "source_artifacts", "qa_interpretation", "validator_contract",
    "submission_context"
  ],
  "properties": {
    "schema_version": { "const": "QA_MAP_MODULE_SPINE.v1" },
    "module_id": {
      "type": "string",
      "pattern": "^[a-z0-9._-]+$",
      "minLength": 1
    },
    "title": { "type": "string", "minLength": 1 },
    "authors": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 1 }
    },
    "created_utc": {
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
    },
    "source_artifacts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["artifact_id", "kind", "title", "citation"],
        "properties": {
          "artifact_id": { "type": "string", "minLength": 1 },
          "kind": { "type": "string", "enum": ["docx", "pdf", "md", "txt", "odt", "url", "other"] },
          "title": { "type": "string", "minLength": 1 },
          "citation": { "type": "string", "minLength": 1 }
        }
      }
    },
    "qa_interpretation": {
      "type": "object",
      "additionalProperties": false,
      "required": ["pattern_space", "state_packet", "generators", "invariants", "obstruction_types"],
      "properties": {
        "pattern_space": {
          "type": "object",
          "additionalProperties": false,
          "required": ["name", "description", "primary_claim_refs"],
          "properties": {
            "name": { "type": "string", "minLength": 1 },
            "description": { "type": "string", "minLength": 1 },
            "primary_claim_refs": {
              "type": "array",
              "minItems": 1,
              "items": { "type": "string", "minLength": 1 }
            }
          }
        },
        "state_packet": {
          "type": "object",
          "additionalProperties": false,
          "required": ["name", "fields"],
          "properties": {
            "name": { "type": "string", "minLength": 1 },
            "fields": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["name", "type", "semantics"],
                "properties": {
                  "name": { "type": "string", "minLength": 1 },
                  "type": { "type": "string", "minLength": 1 },
                  "values": {
                    "type": "array",
                    "items": { "type": "string", "minLength": 1 }
                  },
                  "semantics": { "type": "string", "minLength": 1 }
                }
              }
            }
          }
        },
        "generators": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "signature", "semantics"],
            "properties": {
              "name": { "type": "string", "minLength": 1 },
              "signature": { "type": "string", "minLength": 1 },
              "semantics": { "type": "string", "minLength": 1 }
            }
          }
        },
        "invariants": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "type", "description"],
            "properties": {
              "name": { "type": "string", "minLength": 1 },
              "type": { "type": "string", "minLength": 1 },
              "values": {
                "type": "array",
                "items": { "type": "string", "minLength": 1 }
              },
              "description": { "type": "string", "minLength": 1 }
            }
          }
        },
        "obstruction_types": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["fail_type", "rule"],
            "properties": {
              "fail_type": { "type": "string", "minLength": 1 },
              "rule": { "type": "string", "minLength": 1 }
            }
          }
        }
      }
    },
    "validator_contract": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "determinism", "steps"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "determinism": {
          "type": "object",
          "additionalProperties": false,
          "required": ["canonical_json", "hash"],
          "properties": {
            "canonical_json": { "type": "string", "minLength": 1 },
            "hash": { "type": "string", "minLength": 1 }
          }
        },
        "steps": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["step", "action"],
            "properties": {
              "step": { "type": "string", "minLength": 1 },
              "action": { "type": "string", "minLength": 1 }
            }
          }
        }
      }
    },
    "submission_context": {
      "type": "object",
      "additionalProperties": false,
      "required": ["target_journal", "cover_letter_claims", "refs"],
      "properties": {
        "target_journal": { "type": "string", "minLength": 1 },
        "cover_letter_claims": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 }
        },
        "refs": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 }
        }
      }
    }
  }
}
